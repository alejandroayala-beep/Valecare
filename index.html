<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Invitaci√≥n + Memorama</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --txt:#e9ecff; --muted:#a9b1d6;
      --stroke:rgba(255,255,255,.10); --shadow:0 18px 55px rgba(0,0,0,.45);
      --good:rgba(158,206,106,.22); --pri:rgba(122,162,247,.22);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background:
        radial-gradient(900px 500px at 10% 15%, rgba(122,162,247,.25), transparent 55%),
        radial-gradient(700px 450px at 85% 70%, rgba(247,118,142,.22), transparent 55%),
        radial-gradient(600px 400px at 60% 5%, rgba(158,206,106,.18), transparent 55%),
        var(--bg);
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding:20px;
    }
    .wrap{width:min(920px, 100%);}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    header{
      padding:20px 22px 12px;
      background:linear-gradient(180deg, rgba(122,162,247,.18), transparent 60%);
      border-bottom:1px solid var(--stroke);
    }
    h1{margin:0; font-size:22px}
    .sub{margin:8px 0 0; color:var(--muted); line-height:1.35}
    main{display:grid; gap:14px; padding:18px}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:14px}
    @media (max-width:820px){ .grid{grid-template-columns:1fr} }
    .panel{
      background:rgba(18,26,51,.55);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:16px;
    }
    .panel h2{margin:0 0 10px; font-size:16px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
    .kpis{display:grid; gap:10px}
    .kpi{
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      padding:10px 12px; border-radius:14px;
      background:rgba(0,0,0,.20);
      border:1px solid var(--stroke);
    }
    .kpi b{font-size:14px}
    .kpi span{color:var(--muted)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button, a.btn{
      appearance:none; border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      padding:10px 12px;
      border-radius:14px;
      font-weight:650;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      flex: 1 1 auto;
    }
    .primary{background:var(--pri); border-color:rgba(122,162,247,.40)}
    .good{background:var(--good); border-color:rgba(158,206,106,.38)}
    button:disabled{opacity:.55; cursor:not-allowed}
    .small{font-size:12px; color:var(--muted); line-height:1.35; margin-top:10px}
    .hidden{display:none !important}

    /* Memorama */
    .board{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width:420px){ .board{gap:8px} }
    .tile{
      position:relative;
      aspect-ratio: 1 / 1;
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.22);
      perspective: 900px;
      overflow:hidden;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .inner{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform .22s ease;
    }
    .tile.flipped .inner{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      backface-visibility:hidden;
    }
    .front{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.15));
    }
    .front .mark{
      width:56px; height:56px; border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:center;
      font-size:26px;
    }
    .back{
      transform: rotateY(180deg);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.10));
    }
    .icon{
      font-size:34px;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
    }
    .tile.matched{
      border-color: rgba(158,206,106,.55);
      background:rgba(158,206,106,.12);
      cursor:default;
    }

    canvas{position:fixed; inset:0; pointer-events:none; z-index:9998}
    .toast{
      position:fixed; left:50%; bottom:20px; transform:translateX(-50%);
      background:rgba(0,0,0,.55);
      border:1px solid var(--stroke);
      color:var(--txt);
      padding:10px 12px;
      border-radius:14px;
      box-shadow:var(--shadow);
      font-weight:650;
      z-index:9999;
      opacity:0; pointer-events:none;
      transition:opacity .25s ease;
    }
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <canvas id="fx"></canvas>

  <div class="wrap">
    <div class="card">
      <header>
        <h1 id="headline">Invitaci√≥n + Memorama</h1>
        <p class="sub" id="subtitle">Encuentra todas las parejas para desbloquear la invitaci√≥n.</p>
      </header>

      <main>
        <div class="grid">
          <section class="panel">
            <div class="row" style="gap:12px">
              <h2 style="margin:0">Memorama Arco√≠ris</h2>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                <span class="small" style="margin:0">Movimientos: <b id="moves">0</b></span>
                <span class="small" style="margin:0">Tiempo: <b id="time">00:00</b></span>
              </div>
            </div>

            <div class="board" id="board" style="margin-top:12px"></div>

            <div class="btns">
              <button id="resetBtn">Reiniciar</button>
              <button class="primary" id="shareBtn">Compartir</button>
              <button id="copyBtn">Copiar link</button>
            </div>

            <p class="small" id="status"></p>
          </section>

          <aside class="panel">
            <h2>Datos del evento</h2>

            <div class="kpis" id="lockedBox">
              <div class="kpi"><b>Estado</b><span>Bloqueado üîí</span></div>
              <div class="kpi"><b>Objetivo</b><span>Completar memorama</span></div>
              <div class="kpi"><b>Pista</b><span>Busca parejas iguales</span></div>
            </div>

            <div class="kpis hidden" id="unlockedBox">
              <div class="kpi"><b>Festejada</b><span id="p_name"></span></div>
              <div class="kpi"><b>Cumple</b><span id="p_age"></span></div>
              <div class="kpi"><b>Fecha</b><span id="p_date"></span></div>
              <div class="kpi"><b>Horario</b><span id="p_time"></span></div>
              <div class="kpi"><b>Lugar</b><span id="p_place"></span></div>
              <div class="kpi"><b>Formato</b><span id="p_drop"></span></div>
              <div class="kpi"><b>Tema</b><span id="p_theme"></span></div>

              <div class="btns">
                <a class="btn good" id="rsvpBtn" target="_blank" rel="noopener">Confirmar por WhatsApp</a>
                <a class="btn primary" id="mapBtn" target="_blank" rel="noopener">Abrir mapa</a>
              </div>

              <p class="small" id="extra"></p>
            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <div class="toast" id="toast">Copiado</div>

<script>
/* =========================
   CONFIG (EDITA AQU√ç)
   ========================= */
const CONFIG = {
  celebrantName: "Valeria Alejandra",
  ageText: "10 a√±os",
  dateText: "4 de enero",
  timeText: "D√©jame: 4:00 PM  |  Rec√≥geme: __:__",
  placeText: "Casa de la abuela - Valle Salado 1523",
  dropText: "D√©jame y rec√≥geme (solo ni√±as)",
  themeText: "Ositos Cari√±ositos (estilo arco√≠ris)",
  mapUrl: "https://maps.google.com/?q=Valle+Salado+1523",
  hostWhatsappE164: "521XXXXXXXXXX",
  rsvpPrefill: "Hola, confirmo asistencia (solo ni√±as). Nombre de la ni√±a: __. Hora de llegada: 4:00 PM. Hora de recogida: __:__.",
  extraText: "Evento solo ni√±as. Favor de confirmar. Dejar y recoger puntual.",
  icons: ["üåà","‚≠ê","‚òÄÔ∏è","üíñ","üçÄ","üéµ","‚òÅÔ∏è","ü¶Ñ"]
};
/* ========================= */

const $ = (id)=>document.getElementById(id);
const stateKey = "carebears_memory_inv_v1";

let lock = false;
let first = null;
let second = null;
let moves = 0;

let startTs = null;
let timerInt = null;

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 1200);
}

function pad(n){ return String(n).padStart(2,"0"); }
function fmtTime(ms){
  const s = Math.floor(ms/1000);
  const m = Math.floor(s/60);
  const r = s%60;
  return `${pad(m)}:${pad(r)}`;
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem(stateKey) || "{}");
    return {
      unlocked: !!s.unlocked,
      matched: Array.isArray(s.matched) ? s.matched : [],
      moves: s.moves ?? 0,
      startTs: s.startTs ?? null,
      deck: Array.isArray(s.deck) ? s.deck : null
    };
  }catch{
    return { unlocked:false, matched:[], moves:0, startTs:null, deck:null };
  }
}
function saveState(s){ localStorage.setItem(stateKey, JSON.stringify(s)); }

function buildDeck(){
  const pairs = CONFIG.icons.flatMap(x=>[x,x]);
  return shuffle(pairs.map((icon, idx)=>({ id: idx, icon })));
}

function ensureTimer(){
  if(timerInt) return;
  timerInt = setInterval(()=>{
    const s = loadState();
    if(!s.startTs) return;
    $("time").textContent = fmtTime(Date.now() - s.startTs);
  }, 250);
}

function stopTimer(){
  if(timerInt){ clearInterval(timerInt); timerInt = null; }
}

function render(){
  const s = loadState();
  moves = s.moves;
  $("moves").textContent = moves;

  // Timer
  if(s.startTs){
    $("time").textContent = fmtTime(Date.now() - s.startTs);
    ensureTimer();
  }else{
    $("time").textContent = "00:00";
    stopTimer();
  }

  // Header text
  $("headline").textContent = s.unlocked ? `üéâ Cumple de ${CONFIG.celebrantName}` : "Invitaci√≥n + Memorama";
  $("subtitle").textContent = s.unlocked
    ? "Invitaci√≥n desbloqueada. Confirma por WhatsApp."
    : "Encuentra todas las parejas para desbloquear la invitaci√≥n.";

  // Locked/unlocked panels
  $("lockedBox").classList.toggle("hidden", s.unlocked);
  $("unlockedBox").classList.toggle("hidden", !s.unlocked);

  if(s.unlocked){
    $("p_name").textContent  = CONFIG.celebrantName;
    $("p_age").textContent   = CONFIG.ageText;
    $("p_date").textContent  = CONFIG.dateText;
    $("p_time").textContent  = CONFIG.timeText;
    $("p_place").textContent = CONFIG.placeText;
    $("p_drop").textContent  = CONFIG.dropText;
    $("p_theme").textContent = CONFIG.themeText;
    $("extra").textContent   = CONFIG.extraText;

    const rsvpMsg = [
      CONFIG.rsvpPrefill,
      `Evento: Cumple de ${CONFIG.celebrantName} (${CONFIG.ageText})`,
      `Fecha: ${CONFIG.dateText}`,
      `Horario: ${CONFIG.timeText}`,
      `Lugar: ${CONFIG.placeText}`,
      `Formato: ${CONFIG.dropText}`,
      `Tema: ${CONFIG.themeText}`
    ].join("\n");

    $("rsvpBtn").href = `https://wa.me/${CONFIG.hostWhatsappE164}?text=${encodeURIComponent(rsvpMsg)}`;
    $("mapBtn").href = CONFIG.mapUrl;
  }

  // Status
  const totalPairs = CONFIG.icons.length;
  const matchedPairs = Math.floor(s.matched.length / 2);
  $("status").textContent = s.unlocked
    ? `Listo. Movimientos: ${s.moves}.`
    : `Parejas encontradas: ${matchedPairs}/${totalPairs}`;

  // Board
  const board = $("board");
  board.innerHTML = "";

  const deck = s.deck || buildDeck();
  if(!s.deck){ s.deck = deck; saveState(s); }

  deck.forEach((card, idx)=>{
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.dataset.idx = idx;
    tile.dataset.icon = card.icon;

    const isMatched = s.matched.includes(idx);
    if(isMatched) tile.classList.add("matched","flipped");

    tile.innerHTML = `
      <div class="inner">
        <div class="face front"><div class="mark">‚òÅÔ∏è</div></div>
        <div class="face back"><div class="icon">${card.icon}</div></div>
      </div>
    `;

    tile.addEventListener("click", ()=> onPick(tile));
    board.appendChild(tile);
  });
}

function onPick(tile){
  const s = loadState();
  const idx = Number(tile.dataset.idx);

  if(lock) return;
  if(s.unlocked) return;
  if(s.matched.includes(idx)) return;
  if(tile.classList.contains("flipped")) return;

  // start timer on first move
  if(!s.startTs){
    s.startTs = Date.now();
    saveState(s);
    ensureTimer();
  }

  tile.classList.add("flipped");

  if(!first){
    first = tile;
    return;
  }
  second = tile;
  lock = true;

  // move count after second pick
  s.moves = (s.moves ?? 0) + 1;
  saveState(s);
  $("moves").textContent = s.moves;

  const a = first.dataset.icon;
  const b = second.dataset.icon;

  if(a === b){
    // matched
    const s2 = loadState();
    s2.matched.push(Number(first.dataset.idx), Number(second.dataset.idx));
    saveState(s2);

    first.classList.add("matched");
    second.classList.add("matched");

    first = null; second = null; lock = false;

    // check win
    const totalCards = (CONFIG.icons.length * 2);
    const s3 = loadState();
    if(s3.matched.length >= totalCards){
      s3.unlocked = true;
      saveState(s3);
      confetti();
      render();
    }else{
      render();
    }
  }else{
    setTimeout(()=>{
      first.classList.remove("flipped");
      second.classList.remove("flipped");
      first = null; second = null; lock = false;
    }, 520);
  }
}

function reset(){
  localStorage.removeItem(stateKey);
  lock = false; first = null; second = null; moves = 0;
  stopTimer();
  render();
  toast("Reiniciado");
}

async function copyLink(){
  const url = location.href;
  try{
    await navigator.clipboard.writeText(url);
    toast("Link copiado");
  }catch{
    prompt("Copia este link:", url);
  }
}

async function share(){
  const url = location.href;
  const text = `Invitaci√≥n + memorama: Cumple de ${CONFIG.celebrantName}`;
  try{
    if(navigator.share){
      await navigator.share({ title:"Invitaci√≥n", text, url });
    }else{
      await copyLink();
    }
  }catch{}
}

/* Confetti simple */
function confetti(){
  const c = $("fx");
  const ctx = c.getContext("2d");
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  function resize(){
    c.width = Math.floor(innerWidth * DPR);
    c.height = Math.floor(innerHeight * DPR);
    c.style.width = innerWidth + "px";
    c.style.height = innerHeight + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  resize();

  const pieces = Array.from({length:140}, ()=>({
    x: Math.random()*innerWidth,
    y: -20 - Math.random()*innerHeight*0.3,
    w: 6 + Math.random()*6,
    h: 8 + Math.random()*10,
    vx: -2 + Math.random()*4,
    vy: 2 + Math.random()*5,
    r: Math.random()*Math.PI,
    vr: (-0.2 + Math.random()*0.4),
    a: 0.95
  }));
  const colors = ["#7aa2f7","#9ece6a","#f7768e","#ff9e64","#e0af68","#bb9af7","#2ac3de"];

  let t=0;
  function tick(){
    t++;
    ctx.clearRect(0,0,innerWidth,innerHeight);
    pieces.forEach((p,i)=>{
      p.x += p.vx;
      p.y += p.vy;
      p.r += p.vr;
      p.vy += 0.03;
      if(p.y > innerHeight + 40) p.a = Math.max(0, p.a - 0.02);
      ctx.save();
      ctx.globalAlpha = p.a;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.r);
      ctx.fillStyle = colors[i % colors.length];
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });
    if(t < 220) requestAnimationFrame(tick);
    else ctx.clearRect(0,0,innerWidth,innerHeight);
  }
  tick();
  window.addEventListener("resize", resize, {once:true});
}

$("resetBtn").addEventListener("click", reset);
$("copyBtn").addEventListener("click", copyLink);
$("shareBtn").addEventListener("click", share);

render();
</script>
</body>
</html>
